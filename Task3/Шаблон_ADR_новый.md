### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:** Уфимцев Артем Сергеевич
### <a name="_uanumrh8zrui"></a>**Дата:** 12.07.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| **№** | **Действующие лица или системы**                                                                       | **Use Case**                            | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|:-----:|:-------------------------------------------------------------------------------------------------------|:----------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  UC1  | Пользователь, <br/>Менеджер кол-центра, <br/>Сайт, <br/>CRM                                            | Подача заявки на депозит через сайт     | 1. Пользователь сайта видит список доступных депозитов с актуальными ставками.<br/>2. Пользователь сайта подаёт заявку на депозит, оставив свой телефон и ФИО.<br/>3. Заявка сохраняется в CRM-систему и ожидает обработки.<br/>4. Менеджер кол-центра обрабатывает заявку и перезванивает пользователю для согласования условий депозита.                                                                                                                                                                                                                                  |
|  UC2  | Новый клиент, <br/>Менеджер фронт-офиса, <br/>Менеджер бэк-офиса по депозитам, <br/>АБС, <br/>СМС-шлюз | Оформление депозита в отделении банка   | 1. Менеджер фронт-офиса вносит сведения о новом клиенте в АБС.<br/>2. Менеджер бэк-офиса по депозитам подтверждает ставку и открывает депозит.<br/>3. Менеджер бэк-офиса отказывает в открытии депозита.<br/>4. Новому клиенту приходит СМС-сообщение с результатом рассмотрения заявки на депозит.                                                                                                                                                                                                                                                                         |
|  UC3  | Клиент банка, <br/>Менеджер бэк-офиса по депозитам, <br/>Интернет-банк, <br/>АБС, <br/>СМС-шлюз        | Оформление депозита через интернет-банк | 1. Клиент видит список доступных депозитов с актуальными ставками и персонализированными для него ставками.<br/>2. Клиент подаёт заявку на открытие депозита, указав счёт и сумму депозита.<br/>3. Клиенту приходит СМС-сообщение с одноразовым кодом.<br/>4. Клиент вводит одноразовый код для подтверждения заявки на депозит.<br/>5. Менеджер бэк-офиса по депозитам подтверждает ставку и открывает депозит.<br/>6. Менеджер бэк-офиса по депозитам отказывает в открытии депозита.<br/>7. Клиенту приходит СМС-сообщение с результатом рассмотрения заявки на депозит. |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№**  | **Требование**                                                                                                                           |
|:------:|:-----------------------------------------------------------------------------------------------------------------------------------------|
| **R**  | **Надежность (Reliability)**                                                                                                             |
|   R1   | Все сервисы должны работать 24/7 и иметь доступность 99,9%                                                                               |
|   R2   | В случае сбоев в ЦОД необходимо, чтобы сервисы интернет-банка были доступны и выдерживали требуемую нагрузку                             |
| **P**  | **Производительность (Performance)**                                                                                                     |
|   P1   | Отклик по всем операциям должен быть максимально быстрым и занимать миллисекунды                                                         |
| **+R** | **+ Ограничения (Restrictions)**                                                                                                         |
|  +R1   | Данные заявок на депозит с сайта и из интернет-банка необходимо защищать шифрованием                                                     |
|  +R2   | Реализовать функционал ведения ставок по депозитам и процесс согласования ставок по заявке в АБС                                         |
|  +R3   | При доработках как можно больше использовать имеющиеся технологии, например СУБД MS SQL и Oracle                                         |
|  +R4   | Новые технологии должны быть совместимы с существующими платформами разработки                                                           |
|  +R5   | Новые технологии должны быть знакомы сотрудникам хотя бы на уровне языков программирования                                               |
|  +R6   | Если нужны очереди сообщений, использовать Kafka на перспективу, учесть что текущая версия платформы интернет-банка несовместима с Kafka |
|  +R7   | Возможно перевести интернет-банк на микросервисы пока только в рамках задачи открытия депозитов                                                   |
|  +R8   | Лучше избежать прямой работы интернет-банка с API АБС                                                   |
|  +R9   | Лучше предусмотреть равномерное горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД                                                   |
### <a name="_qmphm5d6rvi3"></a>**Решение**
C4Context.drawio - диаграмма контекста

C4Container.drawio - диаграмма контейнера

Учитывая существующие ограничения производительности и совместимости, было принято решение вынести функционал работы с депозитами в отдельный микросервис на Java Spring Boot, который имеет собственную БД на Postgres, а также использует Kafka для обеспечения асинхронности создания/обработки заявок на депозит.
Микросервис предоставляет REST API:
1. Для создания заявок на депозит из Интернет-банка (ASP.NET приложение отправляет через API заявку, микросервис кладёт её в очередь Kafka)
2. Для обработки заявок из АБС (Delphi-клиент опрашивает API на предмет появления новых заявок, микросервис берёт заявки из очереди Kafka)

Это решение позволит не нагружать дополнительно БД АБС, а так же обеспечит быстрый отклик в Интернет-банке при создании заявок за счёт асинхронности. Написание приложения могут взять на себя специалисты из команды АБС, имеющие опыт в Java-стеке. Они же проведут интеграцию Delphi-приложения АБС к микросервису для запроса заявок оттуда.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
В качестве альтернативы, с учётом необходимости автоматизировать обработку заявок, можно было бы перенести функционал депозитов вместе с данными из БД АБС в БД нового микросервиса, добавить микросервису веб-приложение на React.js, для работы в нём менеджеров по депозитам и менеджеров фронт-офиса с разграничением прав.
Но на этапе MVP этого не требуется, а перенос функционала работы с депозитами и данных из АБС может занять достаточно времени, есть риск не уложиться в отведённые сроки.
Так же, в этом случае пришлось бы переносить интеграцию с СМС-шлюзом и доработку CRM для получения заявок из кол-центра в новый сервис.

**Недостатки, ограничения, риски**

Львиная доля функционала по депозитам по прежнему в АБС, и проблема перегруженности БД не решена - приток новых клиентов может создать проблемы доступности БД, которые придётся временно решать вертикальным масштабированием. 
На будущее всё равно придётся вытаскивать функционал депозитов из АБС.
Так же, интернет-банк может не справиться с нагрузкой, если она резко возрастёт. Возможно имеет смысл перевести его на облачные технологии, что обеспечит защиту от сбоев и горизонтальное масштабирование.

